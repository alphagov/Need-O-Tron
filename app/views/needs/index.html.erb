<table id="needs-table">
  <thead>
    <tr>
      <th scope="col">Title</th>
      <th scope="col">Format</th>
      <th scope="col">Tags</th>
      <th scope="col">Last updated</th>
      <th scope="col">Created by</th>
      <th scope="col">Priority</th>
      <% if params[:in_state] == 'bin' %>
      <th></th>
      <% end %>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
  <% @needs.each do |need| %>
    <tr>
      <th scope="row"><%= link_to need.title, need %> <% if !params[:in_state] %><small class="status-label <%= need.status %>"><%= status_name need.status %></small><% end %></th>
      <td><%= need.format_assigned? ? need.kind : "-" %></td>
      <td><%= need.tag_list %></td>
      <td><%= time_ago_in_words(need.updated_at, true) %></td>
      <td><%= need.creator %></td>
      <td><%= need.prioritised? ? need.priority.to_s : '-' %></td>
      <% if params[:in_state] == 'bin' %>
      <td><%= need.reason_for_decision %></td>
      <% end %>
      <td><%= link_to 'Edit', edit_need_path(need) %></td>
      <td><%= link_to 'Delete', need, confirm: 'Are you sure?', method: :delete %></td>
    </tr>
  <% end %>
  </tbody>
</table>
<p id="csv-download"><a class="button" href="<%= needs_path(:format => 'csv', :in_state => params[:in_state]) %>">Download as a CSV</a></p>
<p id="csv-upload"><%= form_tag(importer_needs_path) do %>
  <%= label_tag :csv, 'CSV with updated priorities:' %>
  <%= file_field_tag :csv %>
  <%= submit_tag 'Upload', class: 'button' %>
<% end %></p>
<% content_for :current_state, params[:in_state] %>
